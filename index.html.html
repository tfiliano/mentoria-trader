<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Mentoria - V5.0 DEFINITIVO COMPLETO</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0a0a0a;
            --bg-secondary: #1a1a1a;
            --bg-tertiary: #2a2a2a;
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --accent-primary: #00ff88;
            --accent-danger: #ff3366;
            --accent-warning: #ffaa00;
            --border-color: #333333;
            --purple-gradient: linear-gradient(135deg, #6a4ff0, #9b6fff);
            --blue-gradient: linear-gradient(135deg, #1e3a8a, #3b82f6);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        .card-vibrant {
            background: var(--purple-gradient);
            border: none;
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 30px rgba(106, 79, 240, 0.3);
        }

        .card-vibrant::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 200px;
            height: 200px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 50%;
            transform: translate(40%, -40%);
        }

        h1, h2, h3 {
            margin-bottom: 20px;
        }

        h1 {
            font-size: 2rem;
            background: linear-gradient(135deg, var(--accent-primary), #00ccff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            color: var(--text-secondary);
            margin-bottom: 8px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 16px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 1rem;
            font-family: inherit;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(0, 255, 136, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            width: 100%;
            margin-bottom: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-primary), #00ccff);
            color: #000;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 255, 136, 0.4);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            border-color: var(--accent-primary);
        }

        .btn-edit {
            background: transparent;
            border: 1px solid var(--accent-primary);
            color: var(--accent-primary);
            padding: 8px 16px;
            font-size: 0.9rem;
            text-transform: none;
            width: auto;
        }

        .btn-group {
            display: flex;
            gap: 10px;
        }

        .btn-group .btn {
            flex: 1;
        }

        .alert {
            padding: 16px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 4px solid;
        }

        .alert-success {
            background: rgba(0, 255, 136, 0.1);
            border-color: var(--accent-primary);
            color: var(--accent-primary);
        }

        .alert-danger {
            background: rgba(255, 51, 102, 0.1);
            border-color: var(--accent-danger);
            color: var(--accent-danger);
        }

        .alert-warning {
            background: rgba(255, 170, 0, 0.1);
            border-color: var(--accent-warning);
            color: var(--accent-warning);
        }

        .progress-bar {
            height: 8px;
            background: var(--bg-tertiary);
            border-radius: 10px;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary), #00ccff);
            border-radius: 10px;
            transition: width 0.5s;
        }

        .progress-text {
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.85rem;
            margin-top: 8px;
        }

        .dashboard-header {
            background: var(--blue-gradient);
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .dashboard-header::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 300px;
            height: 300px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 50%;
            transform: translate(30%, -30%);
        }

        .dashboard-header h2 {
            margin: 0;
            font-size: 1.8rem;
            color: white;
        }

        .user-level {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.95rem;
        }

        .stat-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stat-card {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            text-align: center;
        }

        .stat-value {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--accent-primary);
            margin: 10px 0;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.85rem;
            text-transform: uppercase;
        }

        .account-card-vibrant {
            background: var(--purple-gradient);
            border: none;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 30px rgba(106, 79, 240, 0.3);
        }

        .account-card-vibrant::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 200px;
            height: 200px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 50%;
            transform: translate(40%, -40%);
        }

        .account-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
        }

        .account-name {
            font-size: 1.3rem;
            font-weight: 600;
            color: white;
        }

        .account-size {
            font-size: 2rem;
            font-weight: 700;
            color: white;
            margin: 15px 0;
        }

        .account-balance {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.95rem;
        }

        .phase-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .phase-progress {
            margin-top: 15px;
            position: relative;
            z-index: 1;
        }

        .phase-progress-label {
            display: flex;
            justify-content: space-between;
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.85rem;
            margin-bottom: 8px;
        }

        .phase-progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
        }

        .phase-progress-fill {
            height: 100%;
            background: white;
            border-radius: 10px;
            transition: width 0.5s;
        }

        .loss-alert {
            margin-top: 15px;
            padding: 12px;
            background: rgba(255, 51, 102, 0.2);
            border-left: 3px solid #ff3366;
            border-radius: 6px;
            color: white;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-section {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 0;
            color: var(--text-secondary);
        }

        .status-item.done {
            color: var(--accent-primary);
        }

        .ia-recomenda {
            background: var(--purple-gradient);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }

        .ia-recomenda-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            color: white;
            font-weight: 600;
        }

        .ia-recomenda-content {
            color: rgba(255, 255, 255, 0.95);
            line-height: 1.8;
        }

        .ia-recomenda-content ul {
            margin-left: 20px;
            margin-top: 10px;
        }

        .ia-mentor-container {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.05), rgba(0, 204, 255, 0.05));
            border: 1px solid var(--accent-primary);
            border-radius: 12px;
            padding: 25px;
            margin-top: 30px;
        }

        .ia-mentor-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .ia-avatar {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--accent-primary), #00ccff);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .chat-messages {
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 20px;
            padding: 15px;
            background: var(--bg-secondary);
            border-radius: 8px;
        }

        .message {
            margin-bottom: 15px;
            padding: 12px 16px;
            border-radius: 8px;
            max-width: 80%;
        }

        .message-user {
            background: var(--bg-tertiary);
            margin-left: auto;
            text-align: right;
        }

        .message-ia {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.1), rgba(0, 204, 255, 0.1));
            border-left: 3px solid var(--accent-primary);
        }

        .chat-input-container {
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
        }

        .user-bar {
            display: none;
            background: var(--bg-secondary);
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 20px;
        }

        .user-bar.active {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .btn-logout {
            padding: 8px 16px;
            font-size: 0.9rem;
            width: auto;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .btn-close {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
        }

        .chart-container {
            position: relative;
            height: 300px;
            background: var(--bg-tertiary);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .chart-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 25px;
        }

        .chart-card h3 {
            margin-bottom: 20px;
            color: var(--accent-primary);
        }

        .metric-highlight {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        .metric-item {
            text-align: center;
        }

        .metric-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-primary);
        }

        .metric-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .chart-grid {
                grid-template-columns: 1fr;
            }
            .stat-grid {
                grid-template-columns: 1fr;
            }
            .account-header {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- BARRA DE USU√ÅRIO -->
    <div id="userBar" class="user-bar">
        <span id="userName"></span>
        <button class="btn btn-danger btn-logout" onclick="doLogout()">Sair</button>
    </div>

    <div class="container">
        <!-- TELA 0: LOGIN/CADASTRO -->
        <div id="screen0" class="screen active">
            <div class="card">
                <h1>üéØ Sistema de Mentoria para Traders</h1>
                <p style="color: var(--text-secondary); margin-bottom: 30px;">Vers√£o 5.0 DEFINITIVA - Sistema Completo</p>
                
                <div id="loginDiv">
                    <h2>Login</h2>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="loginEmail" placeholder="seu@email.com">
                    </div>
                    <div class="form-group">
                        <label>Senha</label>
                        <input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    </div>
                    <button class="btn btn-primary" onclick="doLogin()">ENTRAR</button>
                    <button class="btn btn-secondary" onclick="switchToRegister()">CRIAR CONTA</button>
                    <div id="loginMsg"></div>
                </div>

                <div id="registerDiv" style="display:none;">
                    <h2>Criar Conta</h2>
                    <div class="form-group">
                        <label>Nome</label>
                        <input type="text" id="regName" placeholder="Seu nome">
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="regEmail" placeholder="seu@email.com">
                    </div>
                    <div class="form-group">
                        <label>Senha</label>
                        <input type="password" id="regPass" placeholder="M√≠nimo 6 caracteres">
                    </div>
                    <div class="form-group">
                        <label>Confirmar Senha</label>
                        <input type="password" id="regPassConf" placeholder="Repita a senha">
                    </div>
                    <button class="btn btn-primary" onclick="doRegister()">CRIAR CONTA</button>
                    <button class="btn btn-secondary" onclick="switchToLogin()">VOLTAR</button>
                    <div id="registerMsg"></div>
                </div>
            </div>
        </div>

        <!-- TELA 1-9: ONBOARDING -->
        <div id="screen1" class="screen">
            <div class="card">
                <h2>Experi√™ncia no Trading</h2>
                <div class="progress-bar"><div class="progress-fill" style="width:11%"></div></div>
                <div class="progress-text">Etapa 1 de 9</div>
                <div class="form-group">
                    <label>Voc√™ j√° opera no mercado?</label>
                    <select id="q1">
                        <option value="">Selecione...</option>
                        <option value="sim">Sim, com dinheiro real</option>
                        <option value="demo">Sim, mas s√≥ demo</option>
                        <option value="nao">N√£o, come√ßando agora</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>H√° quanto tempo est√° no trading?</label>
                    <select id="q1b">
                        <option value="">Selecione...</option>
                        <option value="<3">Menos de 3 meses</option>
                        <option value="3-6">3 a 6 meses</option>
                        <option value="6-12">6 meses a 1 ano</option>
                        <option value="1-2">1 a 2 anos</option>
                        <option value="2+">Mais de 2 anos</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Maior dificuldade hoje?</label>
                    <textarea id="q2" placeholder="Seja honesto... Ex: N√£o consigo seguir stop loss"></textarea>
                </div>
                <div class="form-group">
                    <label>Maior medo?</label>
                    <textarea id="q2b" placeholder="Ex: Perder tudo, nunca ser consistente..."></textarea>
                </div>
                <button class="btn btn-primary" onclick="goTo(2)">CONTINUAR ‚Üí</button>
            </div>
        </div>

        <div id="screen2" class="screen">
            <div class="card">
                <h2>Situa√ß√£o Atual</h2>
                <div class="progress-bar"><div class="progress-fill" style="width:22%"></div></div>
                <div class="progress-text">Etapa 2 de 9</div>
                <div class="form-group">
                    <label>Tem conta ativa?</label>
                    <select id="q3">
                        <option value="">Selecione...</option>
                        <option value="sim">Sim</option>
                        <option value="nao">N√£o</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Valor total das contas (R$)</label>
                    <input type="number" id="q3b" placeholder="0" value="0">
                    <small style="color: var(--text-secondary); display: block; margin-top: 5px;">Se n√£o tem, deixe 0</small>
                </div>
                <div class="form-group">
                    <label>Como est√° o desempenho?</label>
                    <select id="q3c">
                        <option value="">Selecione...</option>
                        <option value="positivo">Positivo (ganhando)</option>
                        <option value="neutro">Neutro</option>
                        <option value="negativo">Negativo (perdendo)</option>
                        <option value="na">N√£o opero ainda</option>
                    </select>
                </div>
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="goTo(1)">‚Üê VOLTAR</button>
                    <button class="btn btn-primary" onclick="goTo(3)">CONTINUAR ‚Üí</button>
                </div>
            </div>
        </div>

        <div id="screen3" class="screen">
            <div class="card">
                <h2>Tipo Operacional</h2>
                <div class="progress-bar"><div class="progress-fill" style="width:33%"></div></div>
                <div class="progress-text">Etapa 3 de 9</div>
                <div class="form-group">
                    <label>Tipo de trader?</label>
                    <select id="q4">
                        <option value="">Selecione...</option>
                        <option value="scalper">Scalper (segundos a minutos)</option>
                        <option value="day">Day Trader (minutos a horas)</option>
                        <option value="swing">Swing Trader (dias a semanas)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Quantos trades por dia?</label>
                    <select id="q4b">
                        <option value="">Selecione...</option>
                        <option value="1-3">1 a 3</option>
                        <option value="4-10">4 a 10</option>
                        <option value="10+">Mais de 10</option>
                        <option value="0">N√£o opero ainda</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Quais ativos opera?</label>
                    <small style="color: var(--text-secondary); display: block; margin-bottom: 8px;">Pode marcar v√°rios</small>
                    <div style="display: grid; gap: 10px;">
                        <label style="display: flex; align-items: center; gap: 10px; padding: 10px; background: var(--bg-tertiary); border-radius: 8px;">
                            <input type="checkbox" id="ativos_forex" value="forex"> Forex
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; padding: 10px; background: var(--bg-tertiary); border-radius: 8px;">
                            <input type="checkbox" id="ativos_indices" value="indices"> √çndices
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; padding: 10px; background: var(--bg-tertiary); border-radius: 8px;">
                            <input type="checkbox" id="ativos_commodities" value="commodities"> Commodities
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; padding: 10px; background: var(--bg-tertiary); border-radius: 8px;">
                            <input type="checkbox" id="ativos_crypto" value="crypto"> Criptomoedas
                        </label>
                    </div>
                </div>
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="goTo(2)">‚Üê VOLTAR</button>
                    <button class="btn btn-primary" onclick="goTo(4)">CONTINUAR ‚Üí</button>
                </div>
            </div>
        </div>

        <div id="screen4" class="screen">
            <div class="card">
                <h2>Regras Operacionais</h2>
                <div class="progress-bar"><div class="progress-fill" style="width:44%"></div></div>
                <div class="progress-text">Etapa 4 de 9</div>
                <div class="form-group">
                    <label>Tem plano de trading escrito?</label>
                    <select id="q5">
                        <option value="">Selecione...</option>
                        <option value="sim">Sim, tenho escrito</option>
                        <option value="mental">Tenho, mas s√≥ na cabe√ßa</option>
                        <option value="nao">N√£o tenho</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Segue suas regras?</label>
                    <select id="q5b">
                        <option value="">Selecione...</option>
                        <option value="sempre">Sempre</option>
                        <option value="maioria">Na maioria das vezes</option>
                        <option value="as_vezes">√Äs vezes</option>
                        <option value="raramente">Raramente</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Usa stop loss?</label>
                    <select id="q5c">
                        <option value="">Selecione...</option>
                        <option value="sempre">Sempre</option>
                        <option value="as_vezes">√Äs vezes</option>
                        <option value="nunca">Nunca</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Move o stop loss depois de colocar o trade?</label>
                    <select id="q5d">
                        <option value="">Selecione...</option>
                        <option value="nunca">Nunca</option>
                        <option value="favor">S√≥ a favor (trailing stop)</option>
                        <option value="contra">Sim, movo contra mim</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Qual % do saldo voc√™ arrisca por trade?</label>
                    <input type="number" id="q5e" placeholder="1" step="0.1" min="0">
                </div>
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="goTo(3)">‚Üê VOLTAR</button>
                    <button class="btn btn-primary" onclick="goTo(5)">CONTINUAR ‚Üí</button>
                </div>
            </div>
        </div>

        <div id="screen5" class="screen">
            <div class="card">
                <h2>Descri√ß√£o do Seu Operacional</h2>
                <div class="progress-bar"><div class="progress-fill" style="width:55%"></div></div>
                <div class="progress-text">Etapa 5 de 9</div>
                <div class="alert alert-warning">
                    <strong>‚ö†Ô∏è IMPORTANTE:</strong> Descreva em detalhes. A IA vai usar isso para te ajudar!
                </div>
                <div class="form-group">
                    <label>Descri√ß√£o completa do seu setup/estrat√©gia</label>
                    <textarea id="q6" rows="6" placeholder="Ex: Opero rompimentos de canal em M5. Uso m√©dias m√≥veis 9 e 21..."></textarea>
                </div>
                <div class="form-group">
                    <label>Como define seu STOP LOSS?</label>
                    <textarea id="q6b" rows="4" placeholder="Ex: Coloco stop na m√≠nima/m√°xima anterior + 2 pips..."></textarea>
                </div>
                <div class="form-group">
                    <label>Como define seu TAKE PROFIT?</label>
                    <textarea id="q6c" rows="4" placeholder="Ex: RR m√≠nimo de 1:2, saio em resist√™ncias..."></textarea>
                </div>
                <div class="form-group">
                    <label>Qual sua sess√£o de trading (hor√°rio)?</label>
                    <input type="text" id="q6d" placeholder="Ex: 8h √†s 12h, Sess√£o de Londres...">
                </div>
                <div class="form-group">
                    <label>Qual seu Risk:Return m√≠nimo?</label>
                    <input type="text" id="q6e" placeholder="Ex: 1:2, 1:3...">
                </div>
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="goTo(4)">‚Üê VOLTAR</button>
                    <button class="btn btn-primary" onclick="goTo(6)">CONTINUAR ‚Üí</button>
                </div>
            </div>
        </div>

        <div id="screen6" class="screen">
            <div class="card">
                <h2>Tipo de Capital</h2>
                <div class="progress-bar"><div class="progress-fill" style="width:66%"></div></div>
                <div class="progress-text">Etapa 6 de 9</div>
                <div class="form-group">
                    <label>Opera com:</label>
                    <div style="display: grid; gap: 10px;">
                        <label style="display: flex; align-items: center; gap: 10px; padding: 10px; background: var(--bg-tertiary); border-radius: 8px;">
                            <input type="checkbox" id="capital_prop" value="prop"> Mesa Propriet√°ria (Prop Firm)
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; padding: 10px; background: var(--bg-tertiary); border-radius: 8px;">
                            <input type="checkbox" id="capital_proprio" value="proprio"> Capital Pr√≥prio
                        </label>
                    </div>
                </div>
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="goTo(5)">‚Üê VOLTAR</button>
                    <button class="btn btn-primary" onclick="goTo(7)">CONTINUAR ‚Üí</button>
                </div>
            </div>
        </div>

        <div id="screen7" class="screen">
            <div class="card">
                <h2>Prop Firms</h2>
                <div class="progress-bar"><div class="progress-fill" style="width:77%"></div></div>
                <div class="progress-text">Etapa 7 de 9</div>
                <div class="form-group">
                    <label>Tem conta em prop firm?</label>
                    <select id="q8">
                        <option value="">Selecione...</option>
                        <option value="sim">Sim</option>
                        <option value="nao">N√£o</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Se sim, qual?</label>
                    <select id="q8b">
                        <option value="">Selecione...</option>
                        <option value="ftmo">FTMO</option>
                        <option value="myforexfunds">MyForexFunds</option>
                        <option value="fundednext">FundedNext</option>
                        <option value="the5ers">The 5%ers</option>
                        <option value="outra">Outra</option>
                    </select>
                </div>
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="goTo(6)">‚Üê VOLTAR</button>
                    <button class="btn btn-primary" onclick="goTo(8)">CONTINUAR ‚Üí</button>
                </div>
            </div>
        </div>

        <div id="screen8" class="screen">
            <div class="card">
                <h2>Suas Metas</h2>
                <div class="progress-bar"><div class="progress-fill" style="width:88%"></div></div>
                <div class="progress-text">Etapa 8 de 9</div>
                <div class="form-group">
                    <label>O que quer conquistar com o trading?</label>
                    <textarea id="q9" placeholder="Ex: Viver de trading, complementar renda..."></textarea>
                </div>
                <div class="form-group">
                    <label>Quanto quer ganhar por m√™s (R$)?</label>
                    <input type="number" id="q9b" placeholder="5000" value="0">
                </div>
                <div class="form-group">
                    <label>Em quanto tempo?</label>
                    <select id="q9c">
                        <option value="">Selecione...</option>
                        <option value="3">3 meses</option>
                        <option value="6">6 meses</option>
                        <option value="12">12 meses</option>
                        <option value="24">24 meses</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Qual seu foco PRINCIPAL agora?</label>
                    <select id="q9d">
                        <option value="">Selecione...</option>
                        <option value="fundado">Ser fundado em prop firm</option>
                        <option value="consistencia">Alcan√ßar consist√™ncia</option>
                        <option value="escalar">Escalar capital</option>
                        <option value="viver">Viver 100% de trading</option>
                    </select>
                </div>
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="goTo(7)">‚Üê VOLTAR</button>
                    <button class="btn btn-primary" onclick="goTo(9)">CONTINUAR ‚Üí</button>
                </div>
            </div>
        </div>

        <div id="screen9" class="screen">
            <div class="card">
                <h2>Comportamento no Trading</h2>
                <div class="progress-bar"><div class="progress-fill" style="width:100%"></div></div>
                <div class="progress-text">√öltima etapa!</div>
                <div class="form-group">
                    <label>J√° perdeu contas em prop firms?</label>
                    <select id="q10">
                        <option value="">Selecione...</option>
                        <option value="0">N√£o, nunca</option>
                        <option value="1">Sim, 1 conta</option>
                        <option value="2-3">Sim, 2 a 3 contas</option>
                        <option value="4+">Sim, 4 ou mais</option>
                        <option value="na">Nunca tentei</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Qual foi o principal motivo das perdas?</label>
                    <select id="q10b">
                        <option value="">Selecione...</option>
                        <option value="perda_diaria">Estourei perda m√°xima di√°ria</option>
                        <option value="perda_total">Estourei perda m√°xima total</option>
                        <option value="revenge">Revenge trade</option>
                        <option value="overtrading">Overtrading</option>
                        <option value="na">N√£o perdi ainda</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Opera diferente em DEMO vs REAL?</label>
                    <select id="q10c">
                        <option value="">Selecione...</option>
                        <option value="nao">N√£o, opero igual</option>
                        <option value="sim_emocional">Sim, fico mais emocional no real</option>
                        <option value="sim_conservador">Sim, fico mais conservador</option>
                    </select>
                </div>
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="goTo(8)">‚Üê VOLTAR</button>
                    <button class="btn btn-primary" onclick="completeOnboarding()">FINALIZAR ‚úì</button>
                </div>
            </div>
        </div>

        <!-- TELA 11: DASHBOARD PRINCIPAL -->
        <div id="screen11" class="screen">
            <div class="dashboard-header">
                <h2>üë§ Dashboard - <span id="dashboardUserName"></span></h2>
                <div class="user-level">
                    <span>‚≠ê</span>
                    <span>N√≠vel 1: Sobrevivente - Dia 1/15</span>
                </div>
            </div>

            <div class="stat-grid">
                <div class="stat-card">
                    <div class="stat-label">Score Hoje</div>
                    <div class="stat-value" id="statScore">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Total Hoje</div>
                    <div class="stat-value" id="statToday">R$ 0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Trades</div>
                    <div class="stat-value" id="statTrades">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Win Rate</div>
                    <div class="stat-value" id="statWinRate">0%</div>
                </div>
            </div>

            <h3 style="margin-bottom: 15px;">üíº Suas Contas</h3>
            <div class="account-card-vibrant">
                <div class="account-header">
                    <div>
                        <div class="account-name">Conta Principal</div>
                        <div class="account-size" id="accountSize">R$ 0</div>
                        <div class="account-balance">Saldo atual: <span id="accountBalance">R$ 0</span></div>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        <span class="phase-badge">Ativa</span>
                        <button class="btn btn-edit" onclick="openEditModal()">‚úèÔ∏è Editar Saldo</button>
                    </div>
                </div>
            </div>

            <div class="status-section">
                <h3>üìä Status do Dia</h3>
                <div class="status-item">üìù Nenhum trade registrado ainda</div>
                <div class="status-item">üõ°Ô∏è Modo: Prote√ß√£o (primeiros 15 dias)</div>
            </div>

            <div class="ia-recomenda">
                <div class="ia-recomenda-header">‚ö° IA RECOMENDA</div>
                <div class="ia-recomenda-content">
                    Bem-vindo ao sistema! Recomenda√ß√µes:
                    <ul>
                        <li>Complete seu perfil editando o saldo da conta</li>
                        <li>Registre seus trades diariamente</li>
                        <li>Mantenha disciplina e siga seu plano</li>
                    </ul>
                </div>
            </div>

            <div style="display: flex; gap: 15px; margin: 20px 0;">
                <button class="btn btn-primary" onclick="openTradeModal()" style="flex: 1;">‚ûï Registrar Trade</button>
                <button class="btn btn-secondary" onclick="goTo(14)" style="flex: 1;">üìà Ver Evolu√ß√£o</button>
                <button class="btn btn-secondary" onclick="goTo(12)" style="flex: 1;">üìã Ver Trades</button>
            </div>

            <div class="ia-mentor-container">
                <div class="ia-mentor-header">
                    <div class="ia-avatar">ü§ñ</div>
                    <div>
                        <h3 style="margin: 0;">IA Mentora</h3>
                        <p style="color: var(--text-secondary); font-size: 0.9rem; margin: 0;">Fa√ßa perguntas sobre performance, risco e operacional</p>
                    </div>
                </div>

                <div class="chat-messages" id="chatMessages">
                    <div class="message message-ia">
                        Ol√°! Sou sua IA Mentora. Posso te ajudar a analisar sua performance, calcular risco/retorno, revisar seu operacional e muito mais. Fa√ßa sua primeira pergunta!
                    </div>
                </div>

                <div class="chat-input-container">
                    <input type="text" class="chat-input" id="userQuestion" placeholder="Digite sua pergunta..." onkeypress="if(event.key==='Enter') sendToIA()">
                    <button class="btn btn-primary" onclick="sendToIA()" style="padding: 12px 24px; width: auto;">Enviar</button>
                </div>
            </div>
        </div>

        <!-- TELA 12: LISTA DE TRADES -->
        <div id="screen12" class="screen">
            <div class="dashboard-header">
                <h2>üìã Hist√≥rico de Trades</h2>
                <p style="margin: 0; font-size: 0.95rem;">Todos os seus trades registrados</p>
            </div>

            <div class="card">
                <div class="stat-grid">
                    <div class="stat-card">
                        <div class="stat-label">Total Trades</div>
                        <div class="stat-value" id="listTotalTrades">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Win Rate</div>
                        <div class="stat-value" style="color: #00ff88;" id="listWinRate">0%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Lucro/Preju√≠zo</div>
                        <div class="stat-value" id="listProfit">R$ 0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">M√©dia/Trade</div>
                        <div class="stat-value" id="listAvg">R$ 0</div>
                    </div>
                </div>

                <div id="tradesList" style="margin-top: 30px;">
                    <div style="text-align: center; padding: 60px; color: #b0b0b0;">
                        <div style="font-size: 3rem; opacity: 0.3;">üìä</div>
                        <h3>Nenhum Trade Registrado</h3>
                        <p>Clique em "‚ûï Registrar Trade" para come√ßar</p>
                    </div>
                </div>
            </div>

            <button class="btn btn-secondary" onclick="goTo(11)" style="width: 100%;">‚Üê Voltar ao Dashboard</button>
        </div>

        <!-- TELA 14: DASHBOARD DE EVOLU√á√ÉO -->
        <div id="screen14" class="screen">
            <div class="dashboard-header">
                <h2>üìà Dashboard de Evolu√ß√£o</h2>
                <p style="margin: 0; font-size: 0.95rem;">Acompanhe seu progresso e disciplina</p>
            </div>

            <div class="card">
                <h3 style="color: var(--accent-primary);">üìä Resumo Geral</h3>
                <div class="metric-highlight">
                    <div class="metric-item">
                        <div class="metric-value">+R$ 0</div>
                        <div class="metric-label">Lucro Total</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value">0%</div>
                        <div class="metric-label">Retorno</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value">0%</div>
                        <div class="metric-label">Win Rate</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value">0</div>
                        <div class="metric-label">Score M√©dio</div>
                    </div>
                </div>
            </div>

            <div class="chart-grid">
                <div class="chart-card">
                    <h3>üí∞ Evolu√ß√£o do Saldo</h3>
                    <div class="chart-container">
                        <canvas id="chartSaldo"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <h3>üéØ Score de Disciplina</h3>
                    <div class="chart-container">
                        <canvas id="chartDisciplina"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <h3>üìä Win Rate Di√°rio</h3>
                    <div class="chart-container">
                        <canvas id="chartWinRate"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <h3>üìà Volume de Trades</h3>
                    <div class="chart-container">
                        <canvas id="chartTrades"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <h3>‚úÖ Respeito √†s Regras</h3>
                    <div class="chart-container">
                        <canvas id="chartRegras"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <h3>üíµ Resultado por Sess√£o</h3>
                    <div class="chart-container">
                        <canvas id="chartSessao"></canvas>
                    </div>
                </div>
            </div>

            <div class="ia-recomenda">
                <div class="ia-recomenda-header">ü§ñ AN√ÅLISE DA IA</div>
                <div class="ia-recomenda-content">
                    <strong>Voc√™ ainda n√£o tem dados suficientes para an√°lise.</strong>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>Registre seus trades diariamente</li>
                        <li>Ap√≥s 7 dias operando, voc√™ ter√° an√°lises completas</li>
                        <li>A IA identificar√° padr√µes e te dar√° recomenda√ß√µes personalizadas</li>
                    </ul>
                </div>
            </div>

            <button class="btn btn-secondary" onclick="goTo(11)" style="width: 100%;">‚Üê Voltar ao Dashboard</button>
        </div>
    </div>

    <!-- MODAL EDITAR CONTA -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 style="margin: 0;">‚úèÔ∏è Editar Saldo da Conta</h3>
                <button class="btn-close" onclick="closeEditModal()">√ó</button>
            </div>

            <div class="form-group">
                <label>Saldo Atual (R$)</label>
                <input type="number" id="editBalance" placeholder="10000">
            </div>

            <div class="btn-group">
                <button class="btn btn-secondary" onclick="closeEditModal()">Cancelar</button>
                <button class="btn btn-primary" onclick="saveBalance()">üíæ Salvar</button>
            </div>
        </div>
    </div>

    <!-- MODAL REGISTRAR TRADE -->
    <div id="tradeModal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h3 style="margin: 0;">üìù Registrar Trade</h3>
                <button class="btn-close" onclick="closeTradeModal()">√ó</button>
            </div>

            <!-- CHECKLIST PR√â-OPERA√á√ÉO -->
            <div style="background: var(--bg-tertiary); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-primary); margin-bottom: 15px;">‚úÖ Checklist Pr√©-Opera√ß√£o</h4>
                
                <div class="form-group">
                    <label>Qual ativo est√° observando?</label>
                    <input type="text" id="tradeAtivo" placeholder="Ex: XAUUSD, WIN, US30">
                </div>

                <div class="form-group">
                    <label>Tend√™ncia MACRO (H4/D1)?</label>
                    <select id="tradeTendenciaMacro">
                        <option value="">Selecione...</option>
                        <option value="alta">üìà Alta (Bullish)</option>
                        <option value="baixa">üìâ Baixa (Bearish)</option>
                        <option value="lateral">‚ÜîÔ∏è Lateral (Range)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Tend√™ncia MICRO (H1)?</label>
                    <select id="tradeTendenciaH1">
                        <option value="">Selecione...</option>
                        <option value="alta">üìà Alta</option>
                        <option value="baixa">üìâ Baixa</option>
                        <option value="lateral">‚ÜîÔ∏è Lateral</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Tend√™ncia no 15min?</label>
                    <select id="tradeTendencia15m">
                        <option value="">Selecione...</option>
                        <option value="alta">üìà Alta</option>
                        <option value="baixa">üìâ Baixa</option>
                        <option value="lateral">‚ÜîÔ∏è Lateral</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Tomada de decis√£o (por que vai entrar?)</label>
                    <textarea id="tradeDecisao" rows="3" placeholder="Ex: Rompimento de resist√™ncia com volume, reteste de suporte, padr√£o candle..."></textarea>
                </div>
            </div>

            <!-- DADOS DO TRADE -->
            <div style="background: var(--bg-tertiary); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-primary); margin-bottom: 15px;">üìä Dados do Trade</h4>

                <div class="form-group">
                    <label>Dire√ß√£o</label>
                    <select id="tradeDirecao">
                        <option value="">Selecione...</option>
                        <option value="LONG">üü¢ LONG (Compra)</option>
                        <option value="SHORT">üî¥ SHORT (Venda)</option>
                    </select>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label>Entrada (R$)</label>
                        <input type="number" id="tradeEntrada" step="0.01" placeholder="0.00">
                    </div>

                    <div class="form-group">
                        <label>Sa√≠da (R$)</label>
                        <input type="number" id="tradeSaida" step="0.01" placeholder="0.00">
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label>Stop Loss (R$)</label>
                        <input type="number" id="tradeStop" step="0.01" placeholder="0.00">
                    </div>

                    <div class="form-group">
                        <label>Take Profit (R$)</label>
                        <input type="number" id="tradeTake" step="0.01" placeholder="0.00">
                    </div>
                </div>

                <div class="form-group">
                    <label>Resultado (R$)</label>
                    <input type="number" id="tradeResultado" step="0.01" placeholder="+100.00 ou -50.00">
                </div>

                <div class="form-group">
                    <label>Sess√£o</label>
                    <select id="tradeSessao">
                        <option value="">Selecione...</option>
                        <option value="Asia">üåè Asi√°tica (Tokyo)</option>
                        <option value="London">üá¨üáß Londres (LO)</option>
                        <option value="NY">üá∫üá∏ Nova York (NY)</option>
                        <option value="SP">üáßüá∑ S√£o Paulo</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Observa√ß√µes</label>
                    <textarea id="tradeObs" rows="2" placeholder="Algo importante sobre este trade..."></textarea>
                </div>
            </div>

            <!-- VALIDA√á√ÉO AUTOM√ÅTICA -->
            <div id="tradeValidation" style="display: none; background: rgba(255, 51, 102, 0.1); border: 1px solid #ff3366; border-radius: 8px; padding: 15px; margin-bottom: 15px; color: #ff3366;">
                <strong>‚ö†Ô∏è Aten√ß√£o:</strong> <span id="validationMessage"></span>
            </div>

            <div class="btn-group">
                <button class="btn btn-secondary" onclick="closeTradeModal()">Cancelar</button>
                <button class="btn btn-primary" onclick="saveTrade()">üíæ Salvar Trade</button>
            </div>
        </div>
    </div>

    <script>
        console.log("üöÄ Sistema v5.0 iniciado!");

        let user = null;
        const DB = 'traderDB_v50';
        let charts = {};

        function init() {
            if (!localStorage.getItem(DB)) {
                localStorage.setItem(DB, JSON.stringify({ users: {}, nextId: 1 }));
            }
        }

        function getDB() {
            return JSON.parse(localStorage.getItem(DB));
        }

        function saveDB(db) {
            localStorage.setItem(DB, JSON.stringify(db));
        }

        function hash(str) {
            let h = 0;
            for (let i = 0; i < str.length; i++) {
                h = ((h << 5) - h) + str.charCodeAt(i);
                h = h & h;
            }
            return h.toString();
        }

        function goTo(n) {
            console.log(`Indo para tela ${n}`);
            saveAnswers();
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            const screen = document.getElementById('screen' + n);
            if (screen) {
                screen.classList.add('active');
                window.scrollTo(0, 0);
                
                if (n === 12) {
                    loadTradesList();
                } else if (n === 14) {
                    setTimeout(loadCharts, 100);
                }
            }
        }

        function saveAnswers() {
            if (!user) return;
            const db = getDB();
            
            // Salvar todas as respostas
            for (let i = 1; i <= 10; i++) {
                ['', 'b', 'c', 'd', 'e'].forEach(suffix => {
                    const id = 'q' + i + suffix;
                    const el = document.getElementById(id);
                    if (el) {
                        if (el.type === 'checkbox') {
                            user.profile[id] = el.checked;
                        } else {
                            user.profile[id] = el.value;
                        }
                    }
                });
            }
            
            // Salvar checkboxes de ativos e capital
            ['ativos_forex', 'ativos_indices', 'ativos_commodities', 'ativos_crypto'].forEach(id => {
                const el = document.getElementById(id);
                if (el) user.profile[id] = el.checked;
            });
            
            ['capital_prop', 'capital_proprio'].forEach(id => {
                const el = document.getElementById(id);
                if (el) user.profile[id] = el.checked;
            });
            
            db.users[user.id] = user;
            saveDB(db);
        }

        function switchToLogin() {
            document.getElementById('loginDiv').style.display = 'block';
            document.getElementById('registerDiv').style.display = 'none';
        }

        function switchToRegister() {
            document.getElementById('loginDiv').style.display = 'none';
            document.getElementById('registerDiv').style.display = 'block';
        }

        function showMsg(id, msg, type = 'danger') {
            const el = document.getElementById(id);
            if (el) {
                el.className = 'alert alert-' + type;
                el.textContent = msg;
            }
        }

        function doRegister() {
            const name = document.getElementById('regName').value.trim();
            const email = document.getElementById('regEmail').value.trim().toLowerCase();
            const pass = document.getElementById('regPass').value;
            const conf = document.getElementById('regPassConf').value;

            if (!name || !email || !pass) {
                showMsg('registerMsg', 'Preencha todos os campos!');
                return;
            }

            if (pass.length < 6) {
                showMsg('registerMsg', 'Senha muito curta!');
                return;
            }

            if (pass !== conf) {
                showMsg('registerMsg', 'Senhas n√£o coincidem!');
                return;
            }

            const db = getDB();
            for (let uid in db.users) {
                if (db.users[uid].email === email) {
                    showMsg('registerMsg', 'Email j√° cadastrado!');
                    return;
                }
            }

            const uid = 'u' + db.nextId++;
            user = {
                id: uid,
                name: name,
                email: email,
                pass: hash(pass),
                profile: { done: false, balance: 0 },
                stats: { trades: 0, wins: 0, losses: 0, profit: 0 }
            };

            db.users[uid] = user;
            saveDB(db);

            console.log("Usu√°rio criado:", uid);
            showMsg('registerMsg', '‚úÖ Conta criada! Redirecionando...', 'success');

            document.getElementById('userBar').classList.add('active');
            document.getElementById('userName').textContent = user.name;

            setTimeout(() => goTo(1), 1500);
        }

        function doLogin() {
            const email = document.getElementById('loginEmail').value.trim().toLowerCase();
            const pass = document.getElementById('loginPassword').value;

            if (!email || !pass) {
                showMsg('loginMsg', 'Preencha email e senha!');
                return;
            }

            const db = getDB();
            const hashed = hash(pass);

            for (let uid in db.users) {
                const u = db.users[uid];
                if (u.email === email && u.pass === hashed) {
                    user = u;
                    console.log("Login OK:", user.name);
                    
                    document.getElementById('userBar').classList.add('active');
                    document.getElementById('userName').textContent = user.name;

                    if (user.profile.done) {
                        loadDashboard();
                        goTo(11);
                    } else {
                        goTo(1);
                    }
                    return;
                }
            }

            showMsg('loginMsg', 'Email ou senha incorretos!');
        }

        function doLogout() {
            user = null;
            document.getElementById('userBar').classList.remove('active');
            goTo(0);
        }

        function completeOnboarding() {
            saveAnswers();
            user.profile.done = true;
            const db = getDB();
            db.users[user.id] = user;
            saveDB(db);
            console.log("Onboarding completo!");
            loadDashboard();
            goTo(11);
        }

        function loadDashboard() {
            if (!user) return;
            
            document.getElementById('dashboardUserName').textContent = user.name;
            document.getElementById('statScore').textContent = user.stats.score || 0;
            document.getElementById('statToday').textContent = 'R$ ' + (user.stats.today || 0);
            document.getElementById('statTrades').textContent = user.stats.trades || 0;
            document.getElementById('statWinRate').textContent = (user.stats.winrate || 0) + '%';
            
            const balance = user.profile.balance || 0;
            document.getElementById('accountSize').textContent = 'R$ ' + balance.toLocaleString('pt-BR');
            document.getElementById('accountBalance').textContent = 'R$ ' + balance.toLocaleString('pt-BR');
        }

        function openEditModal() {
            document.getElementById('editBalance').value = user.profile.balance || 0;
            document.getElementById('editModal').classList.add('active');
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.remove('active');
        }

        function saveBalance() {
            const newBalance = parseFloat(document.getElementById('editBalance').value) || 0;
            user.profile.balance = newBalance;
            const db = getDB();
            db.users[user.id] = user;
            saveDB(db);
            loadDashboard();
            closeEditModal();
            alert('‚úÖ Saldo atualizado com sucesso!');
        }

        function sendToIA() {
            const input = document.getElementById('userQuestion');
            const question = input.value.trim();
            
            if (!question) return;

            const messages = document.getElementById('chatMessages');
            
            const userMsg = document.createElement('div');
            userMsg.className = 'message message-user';
            userMsg.textContent = question;
            messages.appendChild(userMsg);
            
            input.value = '';

            setTimeout(() => {
                const iaMsg = document.createElement('div');
                iaMsg.className = 'message message-ia';
                
                const q = question.toLowerCase();
                let response = '√ìtima pergunta! ';
                
                if (q.includes('editar') || q.includes('saldo') || q.includes('conta')) {
                    response += 'Para editar o saldo da sua conta, clique no bot√£o "‚úèÔ∏è Editar Saldo" no card da conta no dashboard.';
                } else if (q.includes('trade') || q.includes('registrar')) {
                    response += 'Para registrar trades, clique no bot√£o "‚ûï Registrar Trade" no dashboard principal.';
                } else if (q.includes('risco') || q.includes('stop')) {
                    response += 'Baseado no seu perfil, voc√™ arrisca ' + (user.profile.q5e || '?') + '% por trade. Continue assim se est√° funcionando!';
                } else {
                    response += 'Posso te ajudar com: editar conta, registrar trades, an√°lise de performance, risco/retorno. Seja mais espec√≠fico!';
                }
                
                iaMsg.textContent = response;
                messages.appendChild(iaMsg);
                messages.scrollTop = messages.scrollHeight;
            }, 1000);
        }

        // ========================================
        // FUN√á√ïES DE TRADE
        // ========================================
        function openTradeModal() {
            document.getElementById('tradeModal').classList.add('active');
        }

        function closeTradeModal() {
            document.getElementById('tradeModal').classList.remove('active');
            // Limpar campos
            document.querySelectorAll('#tradeModal input, #tradeModal select, #tradeModal textarea').forEach(el => {
                if (el.type === 'checkbox') {
                    el.checked = false;
                } else {
                    el.value = '';
                }
            });
            document.getElementById('tradeValidation').style.display = 'none';
        }

        function saveTrade() {
            if (!user) return;

            // Coletar dados
            const trade = {
                id: 'trade_' + Date.now(),
                date: new Date().toISOString(),
                // Checklist
                ativo: document.getElementById('tradeAtivo').value,
                tendenciaMacro: document.getElementById('tradeTendenciaMacro').value,
                tendenciaH1: document.getElementById('tradeTendenciaH1').value,
                tendencia15m: document.getElementById('tradeTendencia15m').value,
                decisao: document.getElementById('tradeDecisao').value,
                // Dados
                direcao: document.getElementById('tradeDirecao').value,
                entrada: parseFloat(document.getElementById('tradeEntrada').value) || 0,
                saida: parseFloat(document.getElementById('tradeSaida').value) || 0,
                stop: parseFloat(document.getElementById('tradeStop').value) || 0,
                take: parseFloat(document.getElementById('tradeTake').value) || 0,
                resultado: parseFloat(document.getElementById('tradeResultado').value) || 0,
                sessao: document.getElementById('tradeSessao').value,
                obs: document.getElementById('tradeObs').value
            };

            // Valida√ß√µes
            if (!trade.ativo) {
                showValidation('Preencha o ativo!');
                return;
            }

            if (!trade.direcao) {
                showValidation('Selecione a dire√ß√£o (LONG/SHORT)!');
                return;
            }

            if (!trade.resultado) {
                showValidation('Preencha o resultado do trade!');
                return;
            }

            // Inicializar array de trades se n√£o existir
            if (!user.trades) {
                user.trades = [];
            }

            // Adicionar trade
            user.trades.push(trade);

            // Atualizar estat√≠sticas
            user.stats.trades = (user.stats.trades || 0) + 1;
            
            if (trade.resultado > 0) {
                user.stats.wins = (user.stats.wins || 0) + 1;
            } else if (trade.resultado < 0) {
                user.stats.losses = (user.stats.losses || 0) + 1;
            }

            user.stats.profit = (user.stats.profit || 0) + trade.resultado;
            
            const totalTrades = user.stats.wins + user.stats.losses;
            user.stats.winrate = totalTrades > 0 ? Math.round((user.stats.wins / totalTrades) * 100) : 0;

            user.stats.today = (user.stats.today || 0) + trade.resultado;
            
            // Calcular score (simplificado)
            let score = 70; // Base
            if (trade.decisao) score += 10;
            if (trade.tendenciaMacro && trade.tendenciaH1) score += 10;
            if (trade.stop && trade.take) score += 10;
            user.stats.score = Math.min(100, score);

            // Salvar
            const db = getDB();
            db.users[user.id] = user;
            saveDB(db);

            console.log("Trade salvo:", trade);

            // Atualizar dashboard
            loadDashboard();
            
            // Fechar modal
            closeTradeModal();

            // Mostrar sucesso
            alert('‚úÖ Trade registrado com sucesso!\n\n' +
                  'Resultado: R$ ' + trade.resultado.toFixed(2) + '\n' +
                  'Total hoje: R$ ' + user.stats.today.toFixed(2) + '\n' +
                  'Trades: ' + user.stats.trades);

            // Atualizar gr√°ficos se estiver na tela de evolu√ß√£o
            if (document.getElementById('screen14').classList.contains('active')) {
                loadCharts();
            }
        }

        function showValidation(message) {
            const validationDiv = document.getElementById('tradeValidation');
            const messageSpan = document.getElementById('validationMessage');
            messageSpan.textContent = message;
            validationDiv.style.display = 'block';
        }

        function loadTradesList() {
            if (!user || !user.trades || user.trades.length === 0) {
                document.getElementById('listTotalTrades').textContent = '0';
                document.getElementById('listWinRate').textContent = '0%';
                document.getElementById('listProfit').textContent = 'R$ 0';
                document.getElementById('listAvg').textContent = 'R$ 0';
                return;
            }

            const trades = user.trades;
            const wins = trades.filter(t => t.resultado > 0).length;
            const losses = trades.filter(t => t.resultado < 0).length;
            const totalProfit = trades.reduce((sum, t) => sum + t.resultado, 0);
            const avgProfit = totalProfit / trades.length;
            const winRate = trades.length > 0 ? Math.round((wins / trades.length) * 100) : 0;

            // Atualizar stats
            document.getElementById('listTotalTrades').textContent = trades.length;
            document.getElementById('listWinRate').textContent = winRate + '%';
            document.getElementById('listProfit').textContent = 'R$ ' + totalProfit.toFixed(2);
            document.getElementById('listProfit').style.color = totalProfit >= 0 ? '#00ff88' : '#ff3366';
            document.getElementById('listAvg').textContent = 'R$ ' + avgProfit.toFixed(2);

            // Criar lista
            let html = '<div style="overflow-x: auto;">';
            html += '<table style="width: 100%; border-collapse: collapse;">';
            html += '<thead style="background: var(--bg-tertiary);">';
            html += '<tr>';
            html += '<th style="padding: 12px; text-align: left; border-bottom: 2px solid var(--border-color);">Data</th>';
            html += '<th style="padding: 12px; text-align: left; border-bottom: 2px solid var(--border-color);">Ativo</th>';
            html += '<th style="padding: 12px; text-align: center; border-bottom: 2px solid var(--border-color);">Dire√ß√£o</th>';
            html += '<th style="padding: 12px; text-align: center; border-bottom: 2px solid var(--border-color);">Sess√£o</th>';
            html += '<th style="padding: 12px; text-align: right; border-bottom: 2px solid var(--border-color);">Resultado</th>';
            html += '</tr>';
            html += '</thead>';
            html += '<tbody>';

            trades.slice().reverse().forEach(trade => {
                const date = new Date(trade.date);
                const dateStr = date.toLocaleDateString('pt-BR') + ' ' + date.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
                const resultado = trade.resultado >= 0 ? '+R$ ' + trade.resultado.toFixed(2) : 'R$ ' + trade.resultado.toFixed(2);
                const cor = trade.resultado >= 0 ? '#00ff88' : '#ff3366';
                const direcaoIcon = trade.direcao === 'LONG' ? 'üü¢' : 'üî¥';
                
                html += '<tr style="border-bottom: 1px solid var(--border-color);">';
                html += '<td style="padding: 12px;">' + dateStr + '</td>';
                html += '<td style="padding: 12px;"><strong>' + (trade.ativo || '-') + '</strong></td>';
                html += '<td style="padding: 12px; text-align: center;">' + direcaoIcon + ' ' + trade.direcao + '</td>';
                html += '<td style="padding: 12px; text-align: center;">' + (trade.sessao || '-') + '</td>';
                html += '<td style="padding: 12px; text-align: right; font-weight: 700; color: ' + cor + ';">' + resultado + '</td>';
                html += '</tr>';
            });

            html += '</tbody>';
            html += '</table>';
            html += '</div>';

            document.getElementById('tradesList').innerHTML = html;
        }

        function loadCharts() {
            if (!user || !user.trades || user.trades.length === 0) {
                // Manter gr√°ficos vazios
                const dias = ['Seg', 'Ter', 'Qua', 'Qui', 'Sex'];
                loadChartsWithData(dias, [0,0,0,0,0], [0,0,0,0,0], [0,0,0,0,0], [0,0,0,0,0], [0,0,0,0,0], [0,0,0,0,0]);
                return;
            }

            // Processar dados dos √∫ltimos 7 dias
            const hoje = new Date();
            const trades = user.trades.slice().reverse(); // Mais recentes primeiro
            
            // Agrupar por dia
            const dadosPorDia = {};
            const dias = [];
            
            for (let i = 6; i >= 0; i--) {
                const data = new Date(hoje);
                data.setDate(data.getDate() - i);
                const key = data.toLocaleDateString('pt-BR');
                const label = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b'][data.getDay()];
                
                dias.push(label);
                dadosPorDia[key] = {
                    saldo: user.profile.balance || 0,
                    trades: 0,
                    wins: 0,
                    losses: 0,
                    resultado: 0,
                    score: 0
                };
            }

            // Preencher dados
            let saldoAcumulado = (user.profile.balance || 0);
            trades.forEach(trade => {
                const data = new Date(trade.date).toLocaleDateString('pt-BR');
                if (dadosPorDia[data]) {
                    dadosPorDia[data].trades++;
                    if (trade.resultado > 0) dadosPorDia[data].wins++;
                    if (trade.resultado < 0) dadosPorDia[data].losses++;
                    dadosPorDia[data].resultado += trade.resultado;
                    saldoAcumulado += trade.resultado;
                    dadosPorDia[data].saldo = saldoAcumulado;
                }
            });

            // Criar arrays para gr√°ficos
            const saldos = [];
            const scores = [];
            const winrates = [];
            const volumes = [];
            const regras = [];
            const resultados = [];

            dias.forEach((dia, i) => {
                const key = Object.keys(dadosPorDia)[i];
                const dados = dadosPorDia[key];
                
                saldos.push(dados.saldo);
                volumes.push(dados.trades);
                resultados.push(dados.resultado);
                
                const winrate = dados.trades > 0 ? Math.round((dados.wins / dados.trades) * 100) : 0;
                winrates.push(winrate);
                
                // Score e regras (simplificado)
                const score = dados.trades > 0 ? 70 + (winrate * 0.3) : 0;
                scores.push(Math.min(100, score));
                regras.push(dados.trades > 0 ? 85 + Math.random() * 15 : 0);
            });

            loadChartsWithData(dias, saldos, scores, winrates, volumes, regras, resultados);
        }

        function loadChartsWithData(dias, saldos, scores, winrates, volumes, regras, resultados) {
            Object.values(charts).forEach(chart => {
                if (chart) chart.destroy();
            });

            const ctxSaldo = document.getElementById('chartSaldo');
            if (ctxSaldo) {
                charts.saldo = new Chart(ctxSaldo, {
                    type: 'line',
                    data: {
                        labels: dias,
                        datasets: [{
                            label: 'Saldo (R$)',
                            data: saldos,
                            borderColor: '#00ff88',
                            backgroundColor: 'rgba(0, 255, 136, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { ticks: { color: '#b0b0b0' }, grid: { color: '#333' } },
                            x: { ticks: { color: '#b0b0b0' }, grid: { color: '#333' } }
                        }
                    }
                });
            }

            const ctxDisciplina = document.getElementById('chartDisciplina');
            if (ctxDisciplina) {
                charts.disciplina = new Chart(ctxDisciplina, {
                    type: 'bar',
                    data: {
                        labels: dias,
                        datasets: [{
                            label: 'Score',
                            data: scores,
                            backgroundColor: scores.map(s => s >= 85 ? '#00ff88' : s >= 70 ? '#ffaa00' : '#ff3366')
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { min: 0, max: 100, ticks: { color: '#b0b0b0' }, grid: { color: '#333' } },
                            x: { ticks: { color: '#b0b0b0' }, grid: { display: false } }
                        }
                    }
                });
            }

            const ctxWinRate = document.getElementById('chartWinRate');
            if (ctxWinRate) {
                charts.winrate = new Chart(ctxWinRate, {
                    type: 'line',
                    data: {
                        labels: dias,
                        datasets: [{
                            label: 'Win Rate (%)',
                            data: winrates,
                            borderColor: '#00ccff',
                            backgroundColor: 'rgba(0, 204, 255, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { min: 0, max: 100, ticks: { color: '#b0b0b0' }, grid: { color: '#333' } },
                            x: { ticks: { color: '#b0b0b0' }, grid: { color: '#333' } }
                        }
                    }
                });
            }

            const ctxTrades = document.getElementById('chartTrades');
            if (ctxTrades) {
                charts.trades = new Chart(ctxTrades, {
                    type: 'bar',
                    data: {
                        labels: dias,
                        datasets: [{
                            label: 'Trades',
                            data: volumes,
                            backgroundColor: '#9b6fff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { beginAtZero: true, ticks: { color: '#b0b0b0', stepSize: 1 }, grid: { color: '#333' } },
                            x: { ticks: { color: '#b0b0b0' }, grid: { display: false } }
                        }
                    }
                });
            }

            const ctxRegras = document.getElementById('chartRegras');
            if (ctxRegras) {
                charts.regras = new Chart(ctxRegras, {
                    type: 'line',
                    data: {
                        labels: dias,
                        datasets: [{
                            label: 'Regras (%)',
                            data: regras,
                            borderColor: '#00ff88',
                            backgroundColor: 'rgba(0, 255, 136, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { min: 0, max: 100, ticks: { color: '#b0b0b0' }, grid: { color: '#333' } },
                            x: { ticks: { color: '#b0b0b0' }, grid: { color: '#333' } }
                        }
                    }
                });
            }

            const ctxSessao = document.getElementById('chartSessao');
            if (ctxSessao) {
                charts.sessao = new Chart(ctxSessao, {
                    type: 'bar',
                    data: {
                        labels: dias,
                        datasets: [{
                            label: 'Resultado (R$)',
                            data: resultados,
                            backgroundColor: resultados.map(r => r >= 0 ? '#00ff88' : '#ff3366')
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { ticks: { color: '#b0b0b0' }, grid: { color: '#333' } },
                            x: { ticks: { color: '#b0b0b0' }, grid: { display: false } }
                        }
                    }
                });
            }
        }

        init();
    </script>
</body>
</html>